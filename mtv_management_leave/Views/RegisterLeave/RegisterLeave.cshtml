@using mtv_management_leave.Models.Entity;
@using Microsoft.AspNet.Identity;
@model mtv_management_leave.Models.RegisterLeave.RegisterLeaveRequest

@{ 
    UserInfo currentUser = Html.GetT<UserInfo>("account", "getuserinfo", Context.User.Identity.GetUserId<int>());
}
<div class="card">
    <div class="row">
        <div class="col-sm-6">
            <h4><b>@currentUser.FullName</b><small> (id: @currentUser.Id)</small></h4>
        </div>
        <div class="col-sm-6">
            <h5>Remaining number of days: <small> 
                (@(Html.GetT<double>("account", "GetLeaveRemining",  
                 currentUser.Id, 
                 currentUser.DateBeginWork.HasValue ? currentUser.DateBeginWork.Value : DateTime.Now)))</small></h5>
        </div>

    </div>
    <div class="card-body register-leave-handle">
        <div class="container-fluid">
            @using (Html.BeginForm("RegisterLeave", "Registerleave"))
            {
                @Html.AntiForgeryToken()
                @Html.ValidationSummary(false)
                @Html.HiddenFor(m=> m.Uid)
                @Html.HiddenFor(m => m.IsToday, new { isTodayHidden = Model.IsToday})
            <label class="control-label">
                <b>Infomation register</b>
            </label>
            <div class="row">
                <div class="col-sm-12">
                    <div class="col-sm-4">
                        @Html.vRadio("Today","leaveType", Model.IsToday, new { dataType = "md-hour"})
                    </div>
                    <div class="col-sm-8 leave-type" style="padding-top: 5px;">
                        <div class="col-sm-2 text-right"><label class="control-label">From</label> </div>
                        <div class="col-sm-5 md-date" @Html.Raw(Model.IsToday ?  "style='display: none;'": "")>@Html.vDatePickerFor(m => m.DateStart, showTitle: false)</div>
                        <div class="col-sm-5 md-hour" @Html.Raw(!Model.IsToday ?  "style='display: none;'": "")>@Html.vTimePickerFor(m => m.DateStart, showTitle: false)</div>
                    </div>
                </div>
                <div class="col-sm-12">
                    <div class="col-sm-4">
                        @Html.vRadio("Several days", "leaveType", !Model.IsToday, new { dataType = "md-date" })
                    </div>
                    <div class="col-sm-8 leave-type" style="padding-top: 5px;">
                        <div class="col-sm-2 text-right">To</div>
                        <div class="col-sm-5 md-date" @Html.Raw(Model.IsToday ?  "style='display: none;'": "")>@Html.vDatePickerFor(m => m.DateEnd, showTitle: false)</div>
                        <div class="col-sm-5 md-hour" @Html.Raw(!Model.IsToday ?  "style='display: none;'": "")>@Html.vTimePickerFor(m => m.DateEnd, showTitle: false)</div>
                    </div>
                </div>
            </div>
            <div class="row">
                @(Html.vDropDownListFor(m => m.LeaveTypeId, Html.GetT<IEnumerable<SelectListItem>>("system","LeaveTypeToDropdown")))
            </div>
            <div class="row">
                @Html.vTextAreaFor(m => m.Reason)
            </div>
            }
        </div>
    </div>
</div>

<script type="text/javascript">
    $("body").on("change",".register-leave-handle input[type=radio]", function (e) {
        e.preventDefault();
        var type = $(this).attr("datatype");
        if (type == "md-hour") {
            $(".leave-type .md-hour").css({ "display": "block" });
            $(".leave-type .md-date").css({ "display": "none" });
            $("#IsToday").val("True");
        }
        else if (type == "md-date") {
            $(".leave-type .md-hour").css({ "display": "none" });
            $(".leave-type .md-date").css({ "display": "block" });
            $("#IsToday").val("False");
        }
         
    });
</script>

